<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=windows-1252"
      http-equiv="Content-Type">
    <title>Advice #30011</title>
  </head>
  <body>
    <table style="float: right; background: #F9F9F9;" border="5"
      cellpadding="10" cellspacing="0">
      <tbody>
        <tr>
          <td>
            <h2> <span class="mw-headline"
                id="Advice_Advisor_-_Rule_Table"> <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000"
                  title="Advice Advisor"><span style="color:#1F2BB8;">
                    Compiler Advice (on TI Wiki)</span></a> </span></h2>
            <p> <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/27000"
                title="Compiler/diagnostic messages/C6000/27000"><span
                  style="color:#1F2BB8;"> Advice 27000: Use Optimization
                  Options</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/27001"
                title="Compiler/diagnostic messages/C6000/27001"><span
                  style="color:#1F2BB8;"> Advice 27001: Increase
                  Optimization Level</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/27002"
                title="Compiler/diagnostic messages/C6000/27002"><span
                  style="color:#1F2BB8;"> Advice 27002: Do not turn off
                  software pipelining</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/27003"
                title="Compiler/diagnostic messages/C6000/27003"><span
                  style="color:#1F2BB8;"> Advice 27003: Avoid compiling
                  with debug options</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/27004"
                title="Compiler/diagnostic messages/C6000/27004"><span
                  style="color:#1F2BB8;"> Advice 27004: No Performance
                  Advice generated</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30000"
                title="Compiler/diagnostic messages/C6000/30002"><span
                  style="color:#1F2BB8;"> Advice 30000: Prevent Loop
                  Disqualification due to call</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30001"
                title="Compiler/diagnostic messages/C6000/30002"><span
                  style="color:#1F2BB8;"> Advice 30001: Prevent Loop
                  Disqualification due to rts-call</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30002"
                title="Compiler/diagnostic messages/C6000/30002"><span
                  style="color:#1F2BB8;"> Advice 30002: Prevent Loop
                  Disqualification due to asm statement</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30003"
                title="Compiler/diagnostic messages/C6000/30003"><span
                  style="color:#1F2BB8;"> Advice 30003: Prevent Loop
                  Disqualification due to complex condition</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30004"
                title="Compiler/diagnostic messages/C6000/30004"><span
                  style="color:#1F2BB8;"> Advice 30004: Prevent Loop
                  Disqualification due to switch statement</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30005"
                title="Compiler/diagnostic messages/C6000/30005"><span
                  style="color:#1F2BB8;"> Advice 30005: Prevent Loop
                  Disqualification due to arithmetic operation</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30006"
                title="Compiler/diagnostic messages/C6000/30006"><span
                  style="color:#1F2BB8;"> Advice 30006: Prevent Loop
                  Disqualification due to call(2)</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30007"
                title="Compiler/diagnostic messages/C6000/30007"><span
                  style="color:#1F2BB8;"> Advice 30007: Prevent Loop
                  Disqualification due to rts-call(2)</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30008"
                title="Compiler/diagnostic messages/C6000/30008"><span
                  style="color:#1F2BB8;"> Advice 30008: Improve Loop;
                  Qualify with restrict</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30009"
                title="Compiler/diagnostic messages/C6000/30009"><span
                  style="color:#1F2BB8;"> Advice 30009: Improve Loop;
                  Add MUST_ITERATE pragma</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30010"
                title="Compiler/diagnostic messages/C6000/30010"><span
                  style="color:#1F2BB8;"> Advice 30010: Improve Loop;
                  Add MUST_ITERATE pragma(2)</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/C6000/30011"
                title="Compiler/diagnostic messages/C6000/30011"><span
                  style="color:#1F2BB8;"> Advice 30011: Improve Loop;
                  Add _nassert()</span></a><br>
            </p>
          </td>
        </tr>
      </tbody>
    </table>
    <h2><span id="Typical_Advice" class="mw-headline">Typical Advice </span></h2>
    <pre> advice #30011: Consider adding assertions to indicate n-byte alignment
of variables input1, input2, output if they are actually n-byte
aligned: _nassert((int)(input1)&nbsp;% 8 == 0).

</pre>
    <h2><span id="Why_is_the_Compiler_giving_this_Advice_.3F"
        class="mw-headline">Why is the Compiler giving this
        Advice&nbsp;? </span></h2>
    <p>You may be able to get better loop performance by adding the
      "_nassert" statements in your code. This Advice is issued to alert
      you to this potential performance improvement in your code. </p>
    <p><br>
    </p>
    <h2><span id="What_it_means:" class="mw-headline">What it means: </span></h2>
    <p>Most loops have memory access instructions. The compiler attempts
      to use wider load instructions, and aligned memory accesses
      instead of non-aligned memory accesses to reduce/balance out
      resources used for the memory access instructions. One of the ways
      to let the compiler know that it is safe to use "wider" loads is
      to use the keyword "_nassert". </p>
    <p>_nasserts() make a statement about the value of variable at the
      point in the program where the _nassert() is located. From this
      information, the compiler can often derive the information about
      that variable at other locations in the program. For best
      performance, however, if the function contains multiple loops, it
      may be best to repeat the _nasserts() on entrance to each loop. In
      the following code, the _nassert tells the compiler, for every
      invocation of f(), that ptr is aligned to an 8-byte boundary. Such
      an assertion often leads to the compiler producing code which
      operates on multiple data values with a single instruction, also
      known as SIMD (single instruction multiple data) optimization. </p>
    <div class="csh">
      <pre style="FONT-FAMILY: monospace" class="c"><span style="COLOR: #993333">void</span> f<span style="COLOR: #009900">(</span><span style="COLOR: #993333">short</span> <span style="COLOR: #339933">*</span>ptr<span style="COLOR: #009900">)</span>
<span style="COLOR: #009900">{</span>
    _nassert<span style="COLOR: #009900">(</span><span style="COLOR: #009900">(</span><span style="COLOR: #993333">int</span><span style="COLOR: #009900">)</span> ptr <span style="COLOR: #339933">%</span> 8 <span style="COLOR: #339933">==</span> 0<span style="COLOR: #009900">)</span>
<span style="COLOR: #339933">    ;</span> a loop operating on data accessed by ptr
<span style="COLOR: #009900">}</span></pre>
    </div>
    <p>The C64x and C64x+ processors support both aligned and
      non-aligned double-word loads and stores. If it is known that the
      function parameters are double-word aligned, switching to aligned,
      double-word memory accesses saves both D units and T address
      paths. In the example below, you can get the compiler to select
      the double-word versions of the memory access instructions by
      telling the compiler that the memory accesses are aligned. To tell
      the compiler that the memory accesses are aligned on double-word
      (64-bit) boundaries, use _nasserts() inside the function just
      prior to the loop of interest. </p>
    <div class="csh">
      <pre style="FONT-FAMILY: monospace" class="c"><span style="COLOR: #993333">void</span> BasicLoop<span style="COLOR: #009900">(</span><span style="COLOR: #993333">int</span> <span style="COLOR: #339933">*</span>restrict output<span style="COLOR: #339933">,</span>
<span style="COLOR: #993333">               int</span> <span style="COLOR: #339933">*</span>restrict input1<span style="COLOR: #339933">,</span>
<span style="COLOR: #993333"><span style="COLOR: #993333">               </span>int</span> <span style="COLOR: #339933">*</span>restrict input2<span style="COLOR: #339933">,</span>
<span style="COLOR: #993333"><span style="COLOR: #993333">               </span>int</span> n<span style="COLOR: #009900">)</span>
<span style="COLOR: #009900">{</span>
<span style="COLOR: #993333">    int</span> i<span style="COLOR: #339933">;</span>
&nbsp;
<span style="COLOR: #993333">    </span>_nassert<span style="COLOR: #009900">(</span><span style="COLOR: #009900">(</span><span style="COLOR: #993333">int</span><span style="COLOR: #009900">)</span> input1 <span style="COLOR: #339933">%</span> 8 <span style="COLOR: #339933">==</span> 0<span style="COLOR: #009900">)</span><span style="COLOR: #339933">;</span> <span style="FONT-STYLE: italic; COLOR: #666666">// input1 is 8-byte aligned</span>
<span style="COLOR: #993333">    </span>_nassert<span style="COLOR: #009900">(</span><span style="COLOR: #009900">(</span><span style="COLOR: #993333">int</span><span style="COLOR: #009900">)</span> input2 <span style="COLOR: #339933">%</span> 8 <span style="COLOR: #339933">==</span> 0<span style="COLOR: #009900">)</span><span style="COLOR: #339933">;</span> <span style="FONT-STYLE: italic; COLOR: #666666">// input2 is 8-byte aligned</span>
<span style="COLOR: #993333">    </span>_nassert<span style="COLOR: #009900">(</span><span style="COLOR: #009900">(</span><span style="COLOR: #993333">int</span><span style="COLOR: #009900">)</span> output <span style="COLOR: #339933">%</span> 8 <span style="COLOR: #339933">==</span> 0<span style="COLOR: #009900">)</span><span style="COLOR: #339933">;</span> <span style="FONT-STYLE: italic; COLOR: #666666">// output is 8-byte aligned</span>
&nbsp;
<span style="COLOR: #339933">#pragma MUST_ITERATE(4,,4) // n &gt;= 4, n&nbsp;% 4 = 0</span>
<span style="COLOR: #b1b100"><span style="COLOR: #993333">    </span>for</span> <span style="COLOR: #009900">(</span>i<span style="COLOR: #339933">=</span><span style="COLOR: #0000dd">0</span><span style="COLOR: #339933">;</span> i<span style="COLOR: #339933">&lt;</span>n<span style="COLOR: #339933">;</span> i<span style="COLOR: #339933">++</span><span style="COLOR: #009900">)</span>
<span style="COLOR: #009900"><span style="COLOR: #993333">    </span>{</span>
<span style="COLOR: #993333">        </span>output<span style="COLOR: #009900">[</span>i<span style="COLOR: #009900">]</span> <span style="COLOR: #339933">=</span> input1<span style="COLOR: #009900">[</span>i<span style="COLOR: #009900">]</span> <span style="COLOR: #339933">+</span> input2<span style="COLOR: #009900">[</span>i<span style="COLOR: #009900">]</span><span style="COLOR: #339933">;</span>
<span style="COLOR: #009900"><span style="COLOR: #993333">    </span>}</span>
<span style="COLOR: #009900">}</span></pre>
    </div>
    <p>For further information on conveying information to the compiler
      to improve performance, see <a title="C6000 Compiler: Tuning
        Software Pipelined Loops"
href="http://processors.wiki.ti.com/index.php/C6000_Compiler:_Tuning_Software_Pipelined_Loops">Tuning
Software
        Pipelined Loops</a> and <a class="new" title="000 CGT
        Optimization Lab - 1 (page does not exist)"
href="http://processors.wiki.ti.com/index.php/C6000_CGT_Optimization_Lab_-_1">Optimization
        Lab</a>. </p>
    <p><br>
    </p>
    <h2><span id="Risks.2C_Severity" class="mw-headline">Risks, Severity
      </span></h2>
    <p>When you use mechanisms such as restrict, MUST_ITERATE, or
      _nassert, you are conveying extra information to the compiler.
      Always verify all such information is correct for every call. </p>
    <p><br>
    </p>
    <h2><span id="Suggested_Action" class="mw-headline">Suggested Action
      </span></h2>
    <p>Use "_nassert" statement. </p>
    <h2> <span class="mw-headline" id="More_Resources"> More Resources
      </span></h2>
    <p>Want to squeeze a few more Performance Cycles out of your
      application? Leverage the e2e (Engineer-to-Engineer) online
      community to get all of your Advice questions answered! Or, give
      back to the community with your expertise. </p>
    <p><a
        href="http://e2e.ti.com/support/development_tools/compiler/default.aspx"
        class="external text" rel="nofollow">Go to the TI Compiler's e2e
        online forum!</a>&nbsp; </p>
    <div class="hf-nsfooter">
      <table class="wikitable" style="text-align:center;
        background:White;">
        <tbody>
          <tr>
            <td><a
                href="http://processors.wiki.ti.com/index.php/File:E2e.jpg"
                class="image"><img alt="E2e.jpg"
                  src="http://processors.wiki.ti.com/images/8/82/E2e.jpg"
                  height="63" width="305"></a> </td>
            <td><i>For technical support please post your questions at <a
                  href="http://e2e.ti.com/" class="external free"
                  rel="nofollow">http://e2e.ti.com</a>. </i> </td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>
</html>
