<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1"
      http-equiv="Content-Type">
    <title>ULP Advisor Rule 10.1 Minimize function calls from within
      ISRs</title>
  </head>
  <body>
    <h1> <span class="mw-headline"
        id="ULP_Advisor_.3E_Rule_10.1_Minimize_function_calls_from_within_ISRs">
        <a href="http://processors.wiki.ti.com/index.php/ULP_Advisor"
          title="ULP Advisor"> ULP Advisor</a> &gt; Rule 10.1 Minimize
        function calls from within ISRs </span></h1>
    <table style="float: right; background: #F9F9F9;" border="5"
      cellpadding="10" cellspacing="0">
      <tbody>
        <tr>
          <td>
            <div class="center">
              <div class="floatnone"><a
                  href="http://processors.wiki.ti.com/index.php/ULP_Advisor"
                  title="ULP Advisor"><img alt="ULPAdvisorBanner.PNG"
src="http://processors.wiki.ti.com/images/thumb/b/b9/ULPAdvisorBanner.PNG/320px-ULPAdvisorBanner.PNG"
                    height="107" width="320"></a></div>
            </div>
            <h2> <span class="mw-headline"
                id="ULP_Advisor_-_Rule_Table"> <a
                  href="http://processors.wiki.ti.com/index.php/ULP_Advisor"
                  title="ULP Advisor"><span style="color:#1F2BB8;"> ULP
                    Advisor</span></a> - Rule Table </span></h2>
            <p><a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/10371"
                title="Compiler/diagnostic messages/MSP430/10371"><span
                  style="color:#1F2BB8;"> ULP 1.1 Ensure LPM usage</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1527"
                title="Compiler/diagnostic messages/MSP430/1527"><span
                  style="color:#1F2BB8;"> ULP 2.1 Leverage timer module
                  for delay loops</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1528"
                title="Compiler/diagnostic messages/MSP430/1528"><span
                  style="color:#1F2BB8;"> ULP 3.1 Use ISRs instead of
                  flag polling</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/10372"
                title="Compiler/diagnostic messages/MSP430/10372"><span
                  style="color:#1F2BB8;"> ULP 4.1 Terminate unused GPIOs</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1530"
                title="Compiler/diagnostic messages/MSP430/1530"><span
                  style="color:#1F2BB8;"> ULP 5.1 Avoid
                  processing-intensive operations: modulo, divide.</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1531"
                title="Compiler/diagnostic messages/MSP430/1531"><span
                  style="color:#1F2BB8;"> ULP 5.2 Avoid
                  processing-intensive operations: floating point</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1532"
                title="Compiler/diagnostic messages/MSP430/1532"><span
                  style="color:#1F2BB8;"> ULP 5.3 Avoid
                  processing-intensive operations: (s)printf()</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1533"
                title="Compiler/diagnostic messages/MSP430/1533"><span
                  style="color:#1F2BB8;"> ULP 6.1 Avoid multiplication
                  on devices without hardware multiplier </span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/10422"
                title="Compiler/diagnostic messages/MSP430/10422"><span
                   style="color:#1F2BB8;"> ULP 6.2 Use MATHLIB for complex
                   math operations </span></a><br>
             <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/10436"
                title="Compiler/diagnostic messages/MSP430/10436"><span
                   style="color:#1F2BB8;"> ULP 6.3 Use Low Energy Accelerator (LEA) software
      library </span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1534"
                title="Compiler/diagnostic messages/MSP430/1534"><span
                  style="color:#1F2BB8;"> ULP 7.1 Use local instead of
                  global variables where possible</span></a> <br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1535"
                title="Compiler/diagnostic messages/MSP430/1535"><span
                  style="color:#1F2BB8;"> ULP 8.1 Use 'static' &amp;
                  'const' modifiers for local variables</span></a> <br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1537"
                title="Compiler/diagnostic messages/MSP430/1537"><span
                  style="color:#1F2BB8;"> ULP 9.1 Use pass by reference
                  for large variables</span></a><br>
              <strong class="selflink"><span style="color:#1F2BB8;"> ULP
                  10.1 Minimize function calls from within ISRs</span></strong><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1539"
                title="Compiler/diagnostic messages/MSP430/1539"><span
                  style="color:#1F2BB8;"> ULP 11.1 Use lower bits for
                  loop program control flow</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1540"
                title="Compiler/diagnostic messages/MSP430/1540"><span
                  style="color:#1F2BB8;"> ULP 11.2 Use lower bits for
                  port bit-banging</span></a> <br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1541"
                title="Compiler/diagnostic messages/MSP430/1541"><span
                  style="color:#1F2BB8;"> ULP 12.1 Use DMA for large
                  memcpy() calls</span></a> <br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1542"
                title="Compiler/diagnostic messages/MSP430/1542"><span
                  style="color:#1F2BB8;"> ULP 12.1b Use DMA for
                  potentially large memcpy() calls</span></a> <br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1543"
                title="Compiler/diagnostic messages/MSP430/1543"><span
                  style="color:#1F2BB8;">ULP 12.2 Use DMA for repetitive
                  transfer</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1544"
                title="Compiler/diagnostic messages/MSP430/1544"><span
                  style="color:#1F2BB8;"> ULP 13.1 Count down in loops</span></a><br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1545"
                title="Compiler/diagnostic messages/MSP430/1545"><span
                  style="color:#1F2BB8;"> ULP 14.1 Use unsigned
                  variables for indexing</span></a> <br>
              <a
href="http://processors.wiki.ti.com/index.php/Compiler/diagnostic_messages/MSP430/1546"
                title="Compiler/diagnostic messages/MSP430/1546"><span
                  style="color:#1F2BB8;"> ULP 15.1 Use bit-masks instead
                  of bit-fields</span></a> <br>
            </p>
            <p><b>Let us know what you think!</b> Feedback, suggestions
              &amp; comments <br>
              are welcome @ ULPAdvisorFeedback@list.ti.com </p>
          </td>
        </tr>
      </tbody>
    </table>
    <h2> <span class="mw-headline" id="What_it_means"> What it means </span></h2>
    <p>In an embedded system, and specifically the MSP430
      microcontrollers, the usage of interrupts is key to obtain
      real-time and low-power performance. It is highly recommended to
      develop an interrupt-driven system to service external and
      peripheral events during main application runtime. Additionally,
      servicing the interrupts should be executed in a short and timely
      manner to improve real-time response of the system. Hence
      interrupt service routines should be kept to execute a minimal
      amount of instructions, allowing the CPU to quickly return to
      sleep or its previous task. Most of the processing should take
      place in the main application in active mode. Consequently,
      function calls within an interrupt service routine should be
      avoided to prevent considerable amount of additional code
      execution from being introduced (i.e. on entry: storing the
      current PC, stack, and CPU state, loading the function and
      preparing for its own stack; on exit: restoring the stack and the
      CPU state before going back to continue executing code in the
      original ISR).
    </p>
    <h2> <span class="mw-headline" id="Risks.2C_Severity"> Risks,
        Severity </span></h2>
    <p>Invoking function calls within an Interrupt Service Routine (ISR)
      significantly adds instruction execution cycles to the ISR. This
      time might increase depending on the number of parameters being
      passed, and whether they are passed by value or reference.
    </p>
    <h2> <span class="mw-headline" id="Why_it_is_happening"> Why it is
        happening </span></h2>
    <p>An interrupt service routine (ISR) in the code project
      issues/invokes a function call. <br>
    </p>
    <h2> <span class="mw-headline" id="Remedy"> Remedy </span></h2>
    <p>Instead of calling functions in the ISR, try to inline the
      instructions, i.e. move the code instructions directly into the
      ISR, or move the entire function call out of the ISR if possible
      (especially for processing intensive functions). For the latter
      option, a global flag can be setup to notify the main program to
      invoke the function call when the device is out of the ISR and
      back in active mode.
    </p>
    <p>Alternatively, if the procedure must be executed within the ISR
      context, use macros or inline the function to minimize context
      switching sequences.
    </p>
    <h2> <span class="mw-headline" id="Code_Example"> Code Example </span></h2>
    <pre> unsigned char interrupt_triggered = 0;
 void xxx_ServiceFunction(xxx_param);
 
 #pragma vector=xxx_VECTOR
__interrupt void xxx_ISR(void) 
{ 
   interrupt_triggered = 1;  
 _BIC_SR_IRQ(LPM3_bits);                 // Clear LPM3 bits from 0(SR), go back to Active Mode
}
 
 void main(void)
 {
   while(1)
   {
     /* go to low power mode, wait for xxx interrupt */
     if (interrupt_triggered)
       xxx_ServiceFunction(xxx_param);
   }
 }
</pre>
    <p><br>
      <a
        href="http://focus.ti.com/mcu/docs/mcusplash.tsp?contentId=128826#CE"
        class="external text" rel="nofollow" target="_blank">See the
        rest of the code examples for all MSP430 devices here!</a>
    </p>
    <h2> <span class="mw-headline" id="More_Resources"> More Resources
      </span></h2>
    <p>Want to squeeze a few more nanoAmps out of your application?
      Leverage the e2e (Engineer-to-Engineer) online community to get
      all of your ULP questions answered! Or, if you are an Ultra-Low
      Power pro, give back to the community with your expertise. </p>
    <p><a
href="http://e2e.ti.com/support/microcontrollers/msp43016-bit_ultra-low_power_mcus/f/166.aspx"
        class="external text" rel="nofollow" target="_blank">Go to
        MSP430's e2e online forum!</a>&nbsp; </p>
    <p>If you are posting on the forums in relation to this rule, try
      using the tag "ULP_10.1"
    </p>
    <table style="text-align:center; background:white; width:100%;
      text-align:left; height: 65px border-top: 1px solid;
      border-bottom: 1px solid; border-left: 1px solid; border-right:
      1px solid; border-width: 1px; border-style: solid;">
      <tbody>
        <tr>
          <td width="305px"><a
              href="http://processors.wiki.ti.com/index.php/File:E2e.jpg"
              class="image"><img alt="E2e.jpg"
                src="http://processors.wiki.ti.com/images/8/82/E2e.jpg"
                height="63" width="305"></a>
          </td>
          <td><i>For technical support please post your questions at <a
                href="http://e2e.ti.com" class="external free"
                rel="nofollow" target="_blank">http://e2e.ti.com</a>.
              Please post only comments about the article <b>Compiler/diagnostic
                messages/MSP430/1538</b> here.</i></td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
